name: ğŸ¤– AI Code Review

on:
  # ğŸš€ LÃ¤uft automatisch bei jedem Push auf den main-Branch
  push:
    branches:
      - main

  # ğŸ“… LÃ¤uft automatisch jeden Tag um 22:00 Uhr deutscher Zeit (20:00 UTC)
  schedule:
    - cron: "0 20 * * *"

  # ğŸ§© ErmÃ¶glicht manuelles Starten Ã¼ber den â€Run workflowâ€œ-Button
  workflow_dispatch:

jobs:
  analyze:
    name: KI-Codeanalyse
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Repository auschecken
        uses: actions/checkout@v4

      - name: ğŸ§  Node.js einrichten
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: ğŸ“¦ AbhÃ¤ngigkeiten installieren
        run: npm install openai@6.7.0

      - name: ğŸ” KI-Codeanalyse durchfÃ¼hren
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "ğŸ” Starte tÃ¤gliche Codeanalyse..."
          node ai-bot.js > ai-review-report.md 2>&1 || true

      - name: ğŸ’¾ Ã„nderungen committen
        run: |
          git config --global user.name "AI Reviewer Bot"
          git config --global user.email "bot@jobdropo.ai"
          git add ai-review-report.md || true
          git commit -m "ğŸ” TÃ¤glicher AI-Code-Review (automatisch um 22 Uhr)" || echo "Nichts zu committen"
          git push
